<section class="container-fluid pt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="mat-h2 m-0">User List</h3>
    <form class="filter-section d-flex align-items-center">
      <mat-form-field class="custom-input">
        <mat-label>Filter</mat-label>
        <input
          matInput
          [(ngModel)]="filterText"
          [ngModelOptions]="{ standalone: true }"
          (keyup)="applyFilter($event.target.value)"
        />
        <button
          mat-icon-button
          matSuffix
          *ngIf="filterText"
          (click)="applyFilter('')"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-icon
          svgIcon="search"
          color="primary"
          matSuffix
          *ngIf="!filterText"
        ></mat-icon>
      </mat-form-field>
    </form>
    <button
      mat-flat-button
      class="custom-button ml-3"
      color="primary"
      (click)="onUserGenerate()"
    >
      <mat-icon svgIcon="users-solid" class="mr-2"></mat-icon>
      New Request
    </button>
  </div>

  <div class="table-wrapper">
    <!-- <app-table-loader *ngIf="!userList"></app-table-loader> -->
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="clientName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Client Name</th>
        <td mat-cell *matCellDef="let row">
          {{ row.clientName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="requesterName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ZS Requestor</th>
        <td mat-cell *matCellDef="let row">{{ row.requesterName }}</td>
      </ng-container>

      <ng-container matColumnDef="accessCode">
        <th mat-header-cell *matHeaderCellDef>Access Code</th>
        <td mat-cell *matCellDef="let row">{{ row.accessCode }}</td>
      </ng-container>

      <ng-container matColumnDef="accessStartDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Active Period</th>
        <td mat-cell *matCellDef="let row">
          <span class="d-block whitespace-nowrap">
            {{ row.accessStartDate | date: "dd MMM yyyy" }} -
            {{ row.accessEndDate | date: "dd MMM yyyy" }}</span
          >
        </td>
      </ng-container>

      <ng-container matColumnDef="lastLoggedIn">
        <th mat-header-cell *matHeaderCellDef>Last Logged In</th>
        <td mat-cell *matCellDef="let row">
          <span class="d-block pt-1">{{
            row.lastLoggedIn
              ? (row.lastLoggedIn | date: "dd MMM yyyy , HH:mm:ss")
              : "Not yet accessed"
          }}</span>
          <span class="d-block pb-1">{{
            row.userMetaInfo?.ipAddress
              ? "IP:" + row.userMetaInfo?.ipAddress
              : ""
          }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let row" color="green">
          <span
            class="status"
            [ngClass]="row.status == UserStatus.ACTIVE ? 'active' : 'inactive'"
            >{{ row.status }}</span
          >
        </td>
      </ng-container>

      <ng-container matColumnDef="more">
        <th mat-header-cell *matHeaderCellDef class="text-center">Actions</th>
        <td mat-cell *matCellDef="let row">
          <div class="actions justify-content-between text-center">
            <button mat-icon-button (click)="onUserEditClick(row)">
              <mat-icon
                svgIcon="users-solid"
                color="primary"
                title="Edit"
              ></mat-icon>
            </button>
            <button
              mat-icon-button
              [disabled]="!row.lastLoggedIn"
              (click)="row.lastLoggedIn && openHistoryDialog(row)"
            >
              <mat-icon
                svgIcon="users-solid"
                color="primary"
                title="Logs"
              ></mat-icon>
            </button>
            <button mat-icon-button (click)="onUserViewClick(row)">
              <mat-icon
                svgIcon="users-solid"
                color="primary"
                title="View"
              ></mat-icon>
            </button>
          </div>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [ngClass]="{ highlight: selectedRowIndex == row.accessCode }"
      ></tr>
    </table>
    <div
      class="no-data d-flex align-items-center justify-content-center"
      *ngIf="
        dataSource?.data.length == 0 || dataSource?.filteredData.length == 0
      "
      style="height: 200px"
    >
      <span *ngIf="dataSource.data.length == 0">No data available</span>
      <span
        *ngIf="
          dataSource.data.length > 0 && dataSource.filteredData.length == 0
        "
      >
        No filter data available
      </span>
    </div>
    <mat-paginator
      class="sticky-pagination custom-pagination"
      [pageSizeOptions]="pageSizeOption"
      [pageSize]="pageSize"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</section>
